# Flatnet Gateway - OpenResty Configuration with Forgejo
# Phase 1, Stage 3: Forgejo Integration
#
# This configuration provides Forgejo-specific settings.
# Use this configuration when running Forgejo as the primary service.
#
# Usage:
#   Deploy: ./scripts/deploy-config.sh
#   Update IP: ./scripts/update-upstream.sh --reload
#   Test:   F:\flatnet\openresty\nginx.exe -c F:\flatnet\config\nginx-forgejo.conf -t
#   Start:  F:\flatnet\openresty\nginx.exe -c F:\flatnet\config\nginx-forgejo.conf
#   Reload: F:\flatnet\openresty\nginx.exe -c F:\flatnet\config\nginx-forgejo.conf -s reload
#   Stop:   F:\flatnet\openresty\nginx.exe -c F:\flatnet\config\nginx-forgejo.conf -s stop
#
# Note: This configuration replaces nginx.conf when using Forgejo.
#       To switch back to generic WSL2 proxy, use nginx.conf instead.

#==============================================================================
# Core Settings
#==============================================================================

# Number of worker processes
worker_processes 1;

# Error log configuration
error_log F:/flatnet/logs/error.log info;

# PID file location
pid F:/flatnet/logs/nginx.pid;

#==============================================================================
# Events Block
#==============================================================================

events {
    worker_connections 1024;
}

#==============================================================================
# HTTP Block
#==============================================================================

http {
    #--------------------------------------------------------------------------
    # Basic Settings
    #--------------------------------------------------------------------------

    include F:/flatnet/openresty/conf/mime.types;
    default_type application/octet-stream;
    access_log F:/flatnet/logs/access.log;

    sendfile on;
    keepalive_timeout 65;
    server_tokens off;

    #--------------------------------------------------------------------------
    # Gzip Compression
    #--------------------------------------------------------------------------

    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
    gzip_min_length 1000;

    #--------------------------------------------------------------------------
    # Include Forgejo Configuration
    #--------------------------------------------------------------------------

    # This includes the upstream, map, and server definitions for Forgejo
    include F:/flatnet/config/conf.d/forgejo.conf;
}
