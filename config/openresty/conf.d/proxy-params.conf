# Flatnet Gateway - Proxy Common Parameters
# Phase 1, Stage 2: WSL2 Proxy Configuration
#
# This file contains common proxy settings used for proxying requests
# from OpenResty (Windows) to WSL2 services.
#
# Usage:
#   Include this file in location blocks:
#   location /wsl2/ {
#       include F:/flatnet/config/conf.d/proxy-params.conf;
#       proxy_pass http://wsl2_backend/;
#   }

#------------------------------------------------------------------------------
# Client Information Headers
#------------------------------------------------------------------------------

# Pass the original Host header to the backend
proxy_set_header Host $host;

# Pass the real client IP address
proxy_set_header X-Real-IP $remote_addr;

# Append to existing X-Forwarded-For chain
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

# Pass the original protocol (http/https)
proxy_set_header X-Forwarded-Proto $scheme;

# Pass the original host
proxy_set_header X-Forwarded-Host $host;

# Pass the original port
proxy_set_header X-Forwarded-Port $server_port;

#------------------------------------------------------------------------------
# Timeout Settings
#------------------------------------------------------------------------------

# Timeout for establishing connection to backend
proxy_connect_timeout 60s;

# Timeout for transmitting request to backend
proxy_send_timeout 60s;

# Timeout for reading response from backend
proxy_read_timeout 60s;

#------------------------------------------------------------------------------
# Buffer Settings
#------------------------------------------------------------------------------

# Enable response buffering
proxy_buffering on;

# Size of buffer for first part of response from backend
proxy_buffer_size 4k;

# Number and size of buffers for reading response
proxy_buffers 8 4k;
